name: macos-quick-test
on: [push]
jobs:
  build:
    runs-on: macos-14
    strategy:
      fail-fast: false  # if one fails, do not cancel the other
      matrix:
        # gambit-version: ['', '--with-gambit=master']
        # shared-mode: ['', '--enable-shared']
        gcc-version: ['13']
    steps:
     - name: Checkout
       uses: actions/checkout@v4
       with:
         path: 'src'
         fetch-depth: 0
    # https://github.com/dawidd6/action-download-artifact
     - name: Get Build
       uses: dawidd6/action-download-artifact@v9
       # uses: actions/download-artifact@v4
       with:
         run_id: 14487201513
     - name: Untar & rm .tar
       run: |
         cd build-${{ runner.os }}-gcc-${{ matrix.gcc-version }}
         tar xvf gerbil.tar
         rm gerbil.tar
     - name: git pull new source to build
       run: |
         cd build-${{ runner.os }}-gcc-${{ matrix.gcc-version }}
         git pull ../src "$GITHUB_REF"
     - name: Run tests
       run: |
         cd build-${{ runner.os }}-gcc-${{ matrix.gcc-version }}
         make check
  # run:
  #   needs: build
  #   runs-on: macos-14
  #   steps:
  #    - uses: actions/download-artifact@v4
  #      # with:
  #       #name: my-artifact
  #       #path: your/destination/dir
  #    - name: Display structure of downloaded files
  #      run: ls -R your/destination/dir
    
